name: Deploy to Production

on:
  push:
    branches:
      - main

  workflow_dispatch:  # üëà Allows manual triggering from the GitHub Actions UI
    inputs:
      deployment_reason:
        description: 'Reason for deployment'
        required: false
        default: 'Manual trigger from workflow_dispatch'

jobs:
  deploy:
    runs-on: ubuntu-latest

    environment: prod  # üëà Links to the Environment settings in your repo

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Print deployment info (safe)
        run: |
          echo "Deployment Reason: ${{ github.event.inputs.deployment_reason }}"
          echo "Region: $REGION"
          echo "Endpoint: $ENDPOINT"
        env:
          REGION: ${{ vars.PROD_REGION }}
          ENDPOINT: ${{ vars.PROD_ENDPOINT }}

      - name: Use API key (do not echo it!)
        run: |
          echo "Calling deployment endpoint..."
          curl -H "Authorization: Bearer $API_KEY" "$ENDPOINT/deploy"
        env:
          API_KEY: ${{ secrets.PROD_API_KEY }}     # üîê Use `secrets` for sensitive data
          ENDPOINT: ${{ vars.PROD_ENDPOINT }}
